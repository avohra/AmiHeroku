<html lang="en">
	<head>
		<% include ../partials/ldOut %>
		 <!--<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">-->
	     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
		  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js"></script>
		 <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/mode-cfb.min.js"></script>
		 <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/mode-ctr.min.js"></script>
		 <!--<script type="text/javascript" src="http://chengxianga2008.github.com/node-cryptojs-aes/client/aes.js"></script>
		 <script type="text/javascript" src="https://chengxianga2008.github.com/node-cryptojs-aes/client/jsonformatter.js"></script>-->
	</head>
	<style>
		.modal-overlay {
		    dialogClass: "no-close";
    		display: none; /* Hidden by default */
    		position: fixed; /* Stay in place */
    		z-index: 1; /* Sit on top */
    		padding-top: 100px; /* Location of the box */
    		left: 0;
   			top: 0;
    		width: 100%; /* Full width */
    		height: 100%; /* Full height */
    		overflow: auto; /* Enable scroll if needed */
    		background-color: rgb(0,0,0); /* Fallback color */
    		background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
		} 
		.warning-content {
   			 background-color: #fefefe;
   			 padding: 10px;
   			 border: 1px solid #888;
   			 border-radius: 2px;
    		box-shadow:0 5px 15px rgba(0,0,0,.5);
		}
	</style>
	
	<body>
		<header>
		</header>
		<main>
			<div id="renderLtngComp"/>
		</main>
		
		<div id="modalWarning" class="modal-overlay" style="width: 100%;height: 100%;">
		  	<div class="container">
    				<div class="row">
       					<div class="col-md-3"></div>
					<div class="col-md-6">
                				<div class="warning-content clearfix">
                    					Your session has expired. Click OK to restart it.
                    					<br/><br/>
                    					<button style="float:right;width:100px;" class="btn btn-outline-info" onclick="okConfirmation();">OK</button>
               		 			</div>
					</div>
					<div class="col-md-3"></div>
    				</div>
			</div>
		</div>
		
		<div id="modalSafariEnable" class="modal-overlay" style="width: 100%  !important;height: 100%  !important; display: block">
			<div class="container">
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6">
						<div class="warning-content clearfix">
							The webpage cannot open because cookies are not enabled. Enable cookies in your browser and then retry, or use another browser.
							<br/><br/>
							<button style="float:right;width:100px;" class="btn btn-outline-info" onclick="okConfirm();">Ok</button>
						</div>
					</div>
					<div class="col-md-3"></div>
				</div>
			</div>
		</div>
		
		<footer>
		</footer>
		<script> 
			var SS = SS || { };			
            //create custom json serialization format
var JsonFormatter = {
	stringify: function (cipherParams) {
		// create json object with ciphertext
		var jsonObj = {
			ct: cipherParams.ciphertext.toString(CryptoJS.enc.Base64)
		};
		
		// optionally add iv and salt
		if (cipherParams.iv) {
			jsonObj.iv = cipherParams.iv.toString();
		}
		
		if (cipherParams.salt) {
			jsonObj.s = cipherParams.salt.toString();
		}

		// stringify json object
		return JSON.stringify(jsonObj)
	},

	parse: function (jsonStr) {
		// parse json string
		var jsonObj = JSON.parse(jsonStr);
		
		// extract ciphertext from json object, and create cipher params object
		var cipherParams = CryptoJS.lib.CipherParams.create({
			ciphertext: CryptoJS.enc.Base64.parse(jsonObj.ct)
		});
		
		// optionally extract iv and salt
		if (jsonObj.iv) {
			cipherParams.iv = CryptoJS.enc.Hex.parse(jsonObj.iv);
		}
            
		if (jsonObj.s) {
			cipherParams.salt = CryptoJS.enc.Hex.parse(jsonObj.s);
		}
		
		return cipherParams;
	}
};
			SS.LightningActions = (function() {
				"use strict";
				function onWinLoad() {
				    $("#modalWarning").hide();
					$("#modalSafariEnable").hide();
					var vars = getUrlVars();
					isSafariBrowser();
					if(vars["action"]=="oauth"){
						alert("OAuth Successful");
						window.open(window.location.href, '_self', '');
							window.close();
					}
				}
				
				function getUrlVars(){
				    var vars = [], hash;
				    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
				    for(var i = 0; i < hashes.length; i++)
				    {
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				    }
				    return vars;
				}
				
				function isSafariBrowser(){
					var isSafari = navigator.vendor && navigator.vendor.indexOf('Apple') > -1 &&
                           navigator.userAgent && !navigator.userAgent.match('CriOS');
					if(!navigator.cookieEnabled && isSafari){
        				console.log('ModalWarning check :: 111 ');
					$("#modalSafariEnable").show();
        				//$("#modalSafariEnable").dialog();
        				//$("#modalSafariEnable").style.display = "block";
        			}
        			return false;
				}
				
				var _0x92bc=["\x68\x74\x74\x70\x73\x3A\x2F\x2F\x6C\x64\x6C\x74\x2D\x64\x68\x65\x65\x72\x61\x6A\x2D\x64\x65\x76\x2E\x68\x65\x72\x6F\x6B\x75\x61\x70\x70\x2E\x63\x6F\x6D\x2F\x63\x72\x79\x70\x74\x6F\x2F\x65\x6E\x63\x72\x79\x70\x74\x65\x64\x3F\x63\x61\x6C\x6C\x62\x61\x63\x6B\x3D\x3F","\x64\x6F\x6E\x65","\x65\x6E\x63\x72\x79\x70\x74\x65\x64","\x65\x6E\x63\x72\x79\x70\x74\x65\x64\x20\x6A\x73\x6F\x6E\x20\x73\x74\x72\x69\x6E\x67\x3A\x20","\x6C\x6F\x67","\x67\x65\x74\x4A\x53\x4F\x4E","\x68\x74\x74\x70\x73\x3A\x2F\x2F\x6C\x64\x6C\x74\x2D\x64\x68\x65\x65\x72\x61\x6A\x2D\x64\x65\x76\x2E\x68\x65\x72\x6F\x6B\x75\x61\x70\x70\x2E\x63\x6F\x6D\x2F\x63\x72\x79\x70\x74\x6F\x2F\x70\x61\x73\x73\x70\x68\x72\x61\x73\x65\x3F\x63\x61\x6C\x6C\x62\x61\x63\x6B\x3D\x3F","\x70\x61\x73\x73\x70\x68\x72\x61\x73\x65","\x70\x61\x73\x73\x70\x68\x72\x61\x73\x65\x3A\x20","\x64\x65\x63\x72\x79\x70\x74","\x41\x45\x53","\x73\x74\x72\x69\x6E\x67\x69\x66\x79","\x55\x74\x66\x38","\x65\x6E\x63","\x64\x65\x63\x72\x79\x70\x74\x65\x64\x20\x73\x74\x72\x69\x6E\x67\x3A\x20","\x72\x65\x6E\x49\x64","\x6F\x72\x67\x49\x64\x3D\x20","\x73\x65\x73\x73\x69\x6F\x6E\x49\x64\x6C\x65\x54\x69\x6D\x65\x20\x3A\x20","\x62\x65\x66\x6F\x72\x65\x20\x63\x61\x6C\x6C\x69\x6E\x67\x20\x6C\x6F\x61\x64\x20\x63\x6F\x6D\x70\x6F\x6E\x65\x6E\x74","\x6F\x6E\x6C\x6F\x61\x64","\x75\x73\x65","\x69\x64\x6C\x65\x49\x6E\x74\x65\x72\x76\x61\x6C\x20\x3A\x20","\x6B\x65\x79\x70\x72\x65\x73\x73","\x6D\x6F\x75\x73\x65\x64\x6F\x77\x6E\x20\x3A\x20","\x6D\x6F\x75\x73\x65\x64\x6F\x77\x6E","\x4D\x6F\x64\x61\x6C\x57\x61\x72\x6E\x69\x6E\x67\x20\x63\x68\x65\x63\x6B\x20\x3A\x3A\x20\x20","\x6D\x6F\x64\x61\x6C\x57\x61\x72\x6E\x69\x6E\x67","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64","\x64\x69\x73\x70\x6C\x61\x79","\x73\x74\x79\x6C\x65","\x62\x6C\x6F\x63\x6B","\x72\x65\x61\x64\x79","\x65\x72\x72\x3A\x3A"];function LDLTCMPCreate(){var _0xe2f7x2='<%= accesstoken %>';var _0xe2f7x3=_0x92bc[0];var _0xe2f7x4;$[_0x92bc[5]](_0xe2f7x3,function(_0xe2f7x5){_0xe2f7x4= _0xe2f7x5[_0x92bc[2]];console[_0x92bc[4]](_0x92bc[3]);console[_0x92bc[4]](_0xe2f7x4)})[_0x92bc[1]](function(){});var _0xe2f7x6=_0x92bc[6];$[_0x92bc[5]](_0xe2f7x6,function(_0xe2f7x5){var _0xe2f7x7=_0xe2f7x5[_0x92bc[7]];console[_0x92bc[4]](_0x92bc[8]);console[_0x92bc[4]](_0xe2f7x7);var _0xe2f7x8=CryptoJS[_0x92bc[10]][_0x92bc[9]](_0xe2f7x4,_0xe2f7x7,{format:JsonFormatter});var _0xe2f7x9=CryptoJS[_0x92bc[13]][_0x92bc[12]][_0x92bc[11]](_0xe2f7x8);console[_0x92bc[4]](_0x92bc[14]+ _0xe2f7x9)})[_0x92bc[1]](function(){});var _0xe2f7xa='<%= sfdcurl %>';var _0xe2f7xb='<%= orgid %>';var _0xe2f7xc=getUrlVars()[_0x92bc[15]];var _0xe2f7xd='<%= idletime %>';console[_0x92bc[4]](_0xe2f7xa);console[_0x92bc[4]](_0xe2f7x2);console[_0x92bc[4]](_0x92bc[16]+ _0xe2f7xb);console[_0x92bc[4]](_0x92bc[17]+ _0xe2f7xd);try{$Lightning[_0x92bc[20]]('<%= namespace %>LDLT',function(_0xe2f7xe){console[_0x92bc[4]](_0x92bc[18]);LDT_loadComponent(_0x92bc[19],_0xe2f7x2)},_0xe2f7xa,_0xe2f7x2);$(document)[_0x92bc[31]](function(){var _0xe2f7xf=0;var _0xe2f7x10=setInterval(_0xe2f7x12,65000);console[_0x92bc[4]](_0x92bc[21]+ _0xe2f7x10);$(this)[_0x92bc[22]](function(_0xe2f7x11){_0xe2f7xf= 0});$(this)[_0x92bc[24]](function(_0xe2f7x11){console[_0x92bc[4]](_0x92bc[23]+ _0xe2f7xf);_0xe2f7xf= 0});function _0xe2f7x12(){_0xe2f7xf= _0xe2f7xf+ 1;if(_0xe2f7xf>= _0xe2f7xd){console[_0x92bc[4]](_0x92bc[25]+ document[_0x92bc[27]](_0x92bc[26]));document[_0x92bc[27]](_0x92bc[26])[_0x92bc[29]][_0x92bc[28]]= _0x92bc[30]}}})}catch(err){console[_0x92bc[4]](_0x92bc[32]+ err)}}
			
				function LDT_loadComponent(type, accessToken, subjectId) {
					console.log("Access token within Load Comp :"+accessToken);
					var id = getUrlVars()["renId"];
					var successflag = getUrlVars()["successflag"];
					document.getElementById("renderLtngComp").innerHTML = "";
					$Lightning.createComponent("<%= namespace %>REN_LT_MainComponent", {type: type, subjectId: subjectId, renId:id, oauthId: accessToken}, "renderLtngComp");
				}
				
				return {
					LDLTCMPCreate : LDLTCMPCreate,
					onWinLoad : onWinLoad
				};
			}());
			window.onload =function(){
				SS.LightningActions.onWinLoad();
			}
			
			function getUrlVars(){
				var vars = [], hash;
				var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
				for(var i = 0; i < hashes.length; i++){
					hash = hashes[i].split('=');
					vars.push(hash[0]);
					vars[hash[0]] = hash[1];
				}
				return vars;
			}
			
			function okConfirmation() {
				var accessToken="<%= accesstoken %>";
				var sfdcurl = "<%= sfdcurl %>";
				var orgid = "<%= orgid %>";
				var id = getUrlVars()["renId"];
				var sessionIdleTime = "<%= idletime %>";
					
				console.log(sfdcurl);
				console.log(accessToken);
				console.log('orgId= '+orgid);
				console.log('sessionIdleTime : '+sessionIdleTime);
				console.log(' okConfirmation called   ');
			    window.open('/accesstoken?orgid='+orgid+'&renId='+id, '_self', '');
			}
			
			function okConfirm() {
			    var accessToken="<%= accesstoken %>";
				var sfdcurl = "<%= sfdcurl %>";
				var orgid = "<%= orgid %>";
				var id = getUrlVars()["renId"];
				var sessionIdleTime = "<%= idletime %>";
					
				console.log(sfdcurl);
				console.log(accessToken);
				console.log('orgId= '+orgid);
				console.log('sessionIdleTime : '+sessionIdleTime);
				console.log(' okConfirmation called   ');
				window.open('/accesstoken?orgid='+orgid+'&renId='+id, '_self', '');
                window.close();
			}
			
			SS.LightningActions.LDLTCMPCreate();
		</script>
	</body>
</html>